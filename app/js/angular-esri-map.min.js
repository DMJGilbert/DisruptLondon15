!function(e){"use strict";e.module("esri.core",[])}(angular),function(e){"use strict";e.module("esri.core").factory("esriLoader",["$q",function(e){function t(t){var n=e.defer(),i=t||{};if(r())return n.reject("ESRI API is already loaded."),n.promise;var a=document.createElement("script");return a.type="text/javascript",a.src=i.url||"http://js.arcgis.com/3.14compact",a.onload=function(){n.resolve(window.require)},document.body.appendChild(a),n.promise}function r(){return"undefined"!=typeof window.require}function n(t,n){var i=e.defer();return r()?("string"==typeof t?require([t],function(e){n&&"function"==typeof n&&n(e),i.resolve(e)}):t instanceof Array?require(t,function(){var e=Array.prototype.slice.call(arguments);n&&"function"==typeof n&&n.apply(this,e),i.resolve(e)}):i.reject("An Array<String> or String is required to load modules."),i.promise):(i.reject("Trying to call esriLoader.require(), but esri API has not been loaded yet. Run esriLoader.bootstrap() if you are lazy loading esri ArcGIS API."),i.promise)}return{bootstrap:t,isLoaded:r,require:n}}])}(angular),function(e){"use strict";e.module("esri.core").service("esriRegistry",["$q",function(e){var t={};return{_register:function(r,n){t[r]||(t[r]=e.defer());var i=t[r];return n.then(function(e){return i.resolve(e),e},function(e){return i.reject(e),e}),function(){delete t[r]}},get:function(r){if(t[r])return t[r].promise;var n=e.defer();return t[r]=n,n.promise}}}])}(angular),function(e){"use strict";e.module("esri.core").factory("esriMapUtils",["$q","esriLoader",function(e,t){function r(e){return e instanceof Array}function n(e,t){return"esri.geometry.Extent"===e.declaredClass?e:new t(e)}var i={};return i.addCustomBasemap=function(e,n){return t.require("esri/basemaps").then(function(t){var i=n.baseMapLayers;return!r(i)&&r(n.urls)&&(i=n.urls.map(function(e){return{url:e}})),r(i)&&(t[e]={baseMapLayers:i,thumbnailUrl:n.thumbnailUrl,title:n.title}),t})},i.createMap=function(e,r){return t.require(["esri/map","esri/geometry/Extent"]).then(function(t){var i=t[0],a=t[1];return r&&r.hasOwnProperty("extent")&&(r.extent=n(r.extent,a)),new i(e,r)})},i.createWebMap=function(r,i,a,o){var s=e.defer();return t.require(["esri/arcgis/utils","esri/geometry/Extent"],function(e,t){a.hasOwnProperty("extent")&&(a.extent=n(a.extent,t)),e.createMap(r,i,{mapOptions:a}).then(function(t){o.layerInfos=e.getLegendLayers(t),o.itemInfo=t.itemInfo,s.resolve(t.map)})}),s.promise},i}])}(angular),function(e){"use strict";e.module("esri.core").factory("esriLayerUtils",["esriLoader",function(e){function t(e){var t;return"string"==typeof e&&(t=[],e.split(",").forEach(function(e){var r=parseInt(e);isNaN(r)||t.push(r)})),t}function r(e,t){return"esri.InfoTemplate"===e.declaredClass?e:e instanceof Array&&2===e.length?new t(e[0],e[1]):new t(e.title,e.content)}var n={};return n.createFeatureLayer=function(t,n){return e.require(["esri/layers/FeatureLayer","esri/InfoTemplate"]).then(function(e){var i=e[0],a=e[1];return n&&(n.infoTemplate&&(n.infoTemplate=r(n.infoTemplate,a)),n.hasOwnProperty("mode")&&(n.mode=i[n.mode])),new i(t,n)})},n.createDynamicMapServiceLayer=function(n,i,a){return e.require(["esri/layers/ArcGISDynamicMapServiceLayer","esri/InfoTemplate","esri/layers/ImageParameters"]).then(function(e){var o,s=e[0],u=e[1],c=e[2];if(i){if(i.infoTemplates)for(var l in i.infoTemplates)i.infoTemplates.hasOwnProperty(l)&&(i.infoTemplates[l].infoTemplate=r(i.infoTemplates[l].infoTemplate,u));if("object"==typeof i.imageParameters&&"esri.layers.ImageParameters"!==i.imageParameters.declaredClass){var f=new c;for(var p in i.imageParameters)i.imageParameters.hasOwnProperty(p)&&(f[p]=i.imageParameters[p]);i.imageParameters=f}}return o=new s(n,i),a&&o.setVisibleLayers(t(a)),o})},n.createInfoTemplate=function(t){return e.require("esri/InfoTemplate").then(function(e){return r(t,e)})},n}])}(angular),function(e){"use strict";e.module("esri.map",["esri.core"])}(angular),function(e){"use strict";e.module("esri.map").controller("EsriMapController",["$attrs","$timeout","esriMapUtils","esriRegistry",function(e,t,r,n){function i(e){return"undefined"==typeof e}function a(e,t){var r=t.geographicExtent&&t.geographicExtent.getCenter();r&&(r=r.normalize(),e.center={lat:r.y,lng:r.x}),e.zoom=t.getZoom()}var o,s=e;this.getMapOptions=function(){var e=this.mapOptions()||{};return this.basemap&&(e.basemap=this.basemap),this.center&&(e.center=this.center.lng&&this.center.lat?[this.center.lng,this.center.lat]:this.center),this.zoom&&(e.zoom=this.zoom),e},this.getMap=function(){return o},this.addLayer=function(e,t){return this.getMap().then(function(r){return r.addLayer(e,t)})},this.removeLayer=function(e){return this.getMap().then(function(t){return t.removeLayer(e)})},this.addLayerInfo=function(e){this.layerInfos?this.layerInfos.unshift(e):this.layerInfos=[e]},this.getLayerInfos=function(){return this.layerInfos},this.bindMapEvents=function(e,r){var n=this;this.getMap().then(function(o){o.loaded?(a(n,o),r.load&&n.load()(o)):r.load&&o.on("load",function(){e.$apply(function(){n.load()(o)})}),o.on("extent-change",function(i){r.extentChange&&n.extentChange()(i),n.inUpdateCycle||(n.inUpdateCycle=!0,e.$apply(function(){a(n,o),t(function(){n.inUpdateCycle=!1},0)}))}),e.$watch("mapCtrl.basemap",function(e,t){o.loaded&&e!==t&&o.setBasemap(e)}),n.inUpdateCycle=!1,i(r.center)&&i(r.zoom)||e.$watchGroup(["mapCtrl.center.lng","mapCtrl.center.lat","mapCtrl.zoom"],function(e){n.inUpdateCycle||""!==e[0]&&""!==e[1]&&""!==e[2]&&(n.inUpdateCycle=!0,o.centerAndZoom([e[0],e[1]],e[2]).then(function(){n.inUpdateCycle=!1}))}),e.$on("$destroy",function(){n.deregister&&n.deregister(),o.destroy()})})},o=s.webmapId?r.createWebMap(s.webmapId,s.id,this.getMapOptions(),this):r.createMap(s.id,this.getMapOptions()),s.registerAs&&(this.deregister=n._register(s.registerAs,o))}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriMap",function(){return{restrict:"E",scope:{center:"=?",zoom:"=?",itemInfo:"=?",basemap:"@",load:"&",extentChange:"&",mapOptions:"&"},controllerAs:"mapCtrl",bindToController:!0,controller:"EsriMapController",compile:function(e,t){return e.removeAttr("id"),e.append("<div id="+t.id+"></div>"),function(e,t,r,n){n.bindMapEvents(e,r)}}}})}(angular),function(e){"use strict";e.module("esri.map").directive("esriLegend",["$q","esriLoader",function(e,t){return{priority:-10,restrict:"EA",require:["?esriLegend","^esriMap"],replace:!0,scope:{},controllerAs:"legendCtrl",bindToController:!0,controller:function(){},link:function(r,n,i,a){var o=a[1],s=i.targetId||i.id,u=e.defer();t.require(["esri/dijit/Legend"],function(e){o.getMap().then(function(t){var n,i={map:t},a=o.getLayerInfos();a&&(i.layerInfos=a),n=new e(i,s),n.startup(),r.$watchCollection(function(){return o.getLayerInfos()},function(e){n.refresh(e)}),u.resolve(n),r.$on("$destroy",function(){n.destroy()})})})}}}])}(angular),function(e){"use strict";e.module("esri.map").controller("EsriLayerControllerBase",function(){function e(e){return e===!0||"true"===e}this.getLayerOptions=function(){var t=this.layerOptions()||{};return"undefined"!=typeof this.visible&&(t.visible=e(this.visible)),this.opacity&&(t.opacity=Number(this.opacity)),t},this.getLayerInfo=function(e,t){return{title:t.title||e.name,layer:e,hideLayers:t.hideLayers?t.hideLayers.split(",").map(Number):void 0,defaultSymbol:t.defaultSymbol?JSON.parse(t.defaultSymbol):!0}},this._bindLayerEvents=function(t,r,n,i){r.load&&(n.loaded?t.layerCtrl.load()(n):n.on("load",function(){t.$apply(function(){t.layerCtrl.load()(n)})})),r.updateEnd&&n.on("update-end",function(e){t.$apply(function(){t.layerCtrl.updateEnd()(e)})}),t.$watch("layerCtrl.visible",function(t,r){t!==r&&n.setVisibility(e(t))}),t.$watch("layerCtrl.opacity",function(e,t){e!==t&&n.setOpacity(Number(e))}),t.$on("$destroy",function(){i.removeLayer(n)})}})}(angular),function(e){"use strict";e.module("esri.map").controller("EsriFeatureLayerController",["$controller","esriLayerUtils",function(t,r){var n;e.extend(this,t("EsriLayerControllerBase")),this.getFeatureLayerOptions=function(){var e=this.getLayerOptions();return this.definitionExpression&&(e.definitionExpression=this.definitionExpression),e},this.getLayer=function(){return n},this.setInfoTemplate=function(e){return this.getLayer().then(function(t){return r.createInfoTemplate(e).then(function(e){return t.setInfoTemplate(e),e})})},this.bindLayerEvents=function(e,t,r,n){this._bindLayerEvents(e,t,r,n),e.$watch("layerCtrl.definitionExpression",function(e,t){e!==t&&r.setDefinitionExpression(e)})},n=r.createFeatureLayer(this.url,this.getFeatureLayerOptions())}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriFeatureLayer",function(){return{restrict:"E",require:["esriFeatureLayer","^esriMap"],replace:!0,scope:{url:"@",visible:"@?",opacity:"@?",definitionExpression:"@?",load:"&",updateEnd:"&",layerOptions:"&"},controllerAs:"layerCtrl",bindToController:!0,controller:"EsriFeatureLayerController",link:function(e,t,r,n){var i=n[0],a=n[1];i.getLayer().then(function(t){var n=i.getLayerInfo(t,r);a.addLayer(t,0),a.addLayerInfo(n),i.bindLayerEvents(e,r,t,a)})}}})}(angular),function(e){"use strict";e.module("esri.map").controller("EsriDynamicMapServiceLayerController",["$controller","esriLayerUtils",function(t,r){var n;e.extend(this,t("EsriLayerControllerBase")),this.getLayer=function(){return n},this.setInfoTemplate=function(e,t){return this.getLayer().then(function(n){return r.createInfoTemplate(t).then(function(t){var r=n.infoTemplates;return r||(r={}),r[e]={infoTemplate:t},n.setInfoTemplates(r),r})})},this.bindLayerEvents=function(e,t,r,n){this._bindLayerEvents(e,t,r,n)},n=r.createDynamicMapServiceLayer(this.url,this.getLayerOptions(),this.visibleLayers)}])}(angular),function(e){"use strict";e.module("esri.map").directive("esriDynamicMapServiceLayer",function(){return{restrict:"E",require:["esriDynamicMapServiceLayer","^esriMap"],replace:!0,scope:{url:"@",visible:"@?",opacity:"@?",visibleLayers:"@?",load:"&",updateEnd:"&",layerOptions:"&"},controllerAs:"layerCtrl",bindToController:!0,controller:"EsriDynamicMapServiceLayerController",link:function(e,t,r,n){var i=n[0],a=n[1];i.getLayer().then(function(t){var n=i.getLayerInfo(t,r);a.addLayer(t),a.addLayerInfo(n),i.bindLayerEvents(e,r,t,a)})}}})}(angular),function(e){"use strict";e.module("esri.map").directive("esriInfoTemplate",function(){return{restrict:"E",require:["?esriInfoTemplate","?^esriDynamicMapServiceLayer","?^esriFeatureLayer"],replace:!0,compile:function(e){var t=e.html();return e.html(""),function(e,r,n,i){var a=i[1],o=i[2];a&&a.setInfoTemplate(n.layerId,{title:n.title,content:t}),o&&o.setInfoTemplate({title:n.title,content:t})}}}})}(angular);